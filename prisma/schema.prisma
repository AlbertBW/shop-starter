// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Post {
    id        Int      @id @default(autoincrement())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model Product {
    id              Int              @id @default(autoincrement())
    name            String
    description     String
    slug            String           @unique
    sku             String           @unique
    price           Float
    salePrice       Float?
    salePriceStart  DateTime?
    salePriceEnd    DateTime?
    currency        String
    stock           Int
    sold            Int
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
    category        Category?        @relation(fields: [categoryId], references: [id], onDelete: SetNull)
    ProductVariants ProductVariant[]
    ProductImages   ProductImage[]
    OrderItem       OrderItem[]
    categoryId      Int?
    CartItem        CartItem[]

    @@index([slug])
}

model ProductVariant {
    id             Int       @id @default(autoincrement())
    name           String
    sku            String    @unique
    price          Float
    salePrice      Float?
    salePriceStart DateTime?
    salePriceEnd   DateTime?
    currency       String
    stock          Int
    sold           Int
    productId      Int
    createdAt      DateTime  @default(now())
    updatedAt      DateTime  @updatedAt

    product  Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
    CartItem CartItem[]

    @@index([name])
}

model ProductImage {
    id        Int      @id @default(autoincrement())
    imageUrl  String
    altText   String
    productId Int
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

    @@index([imageUrl])
}

model Category {
    id        Int       @id @default(autoincrement())
    name      String
    slug      String
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    Product   Product[]

    @@index([name])
}

model Order {
    id        Int         @id @default(autoincrement())
    userId    String
    name      String
    email     String
    phone     String
    address   String
    city      String
    state     String
    country   String
    zip       String
    total     Float
    status    String
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt
    OrderItem OrderItem[]

    @@index([email])
}

model OrderItem {
    id        Int      @id @default(autoincrement())
    orderId   Int
    productId Int
    quantity  Int
    price     Float
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id], onDelete: NoAction)

    @@index([orderId])
}

model Cart {
    id        Int        @id @default(autoincrement())
    userId    String?
    sessionId String?
    status    String     @default("active") // active, abandoned
    createdAt DateTime   @default(now())
    updatedAt DateTime   @updatedAt
    items     CartItem[]

    @@index([userId])
    @@index([sessionId])
}

model CartItem {
    id        Int      @id @default(autoincrement())
    cartId    Int
    productId Int
    variantId Int?
    quantity  Int
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    cart    Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
    product Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
    variant ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

    @@index([cartId])
}
